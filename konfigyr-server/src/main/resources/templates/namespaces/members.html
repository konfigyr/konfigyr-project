<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}"
      lang="en">
<head>
    <title th:text="${namespace.name}">Konfigyr</title>
</head>
<body>

<th:block layout:fragment="header">
    <nav th:replace="~{layout/header :: header (namespace=${namespace.slug})}">
    </nav>
</th:block>

<th:block layout:fragment="sub-header">
    <nav th:replace="~{namespaces/header :: header (namespace=${namespace.slug}, active='overview')}">
    </nav>
</th:block>

<main layout:fragment="main">
    <div class="container">
        <th:block th:replace="~{fragments/heading :: heading(
            avatar=${namespace.avatar},
            title=${namespace.name},
            subtitle=${namespace.description},
        )}" />

        <div class="row">
            <aside class="col-12 col-md-3">
                <ul class="px-0">
                    <li>
                        <a th:href="@{/namespace/{slug}/members(slug=${namespace.slug})}"
                           th:text="#{namespace.nav.members}">
                            Members
                        </a>
                    </li>
                    <li>
                        <a th:href="@{/namespace/{slug}/members/invitations(slug=${namespace.slug})}"
                            th:text="#{namespace.nav.invitations}">
                            Invitations
                        </a>
                    </li>
                </ul>
            </aside>

            <div class="col-12 col-md-9">
                <form th:object="${invitationForm}"
                      th:action="@{/namespace/{slug}/members(slug=${namespace.slug})}"
                      method="post" class="mb-5"
                >
                    <article>
                        <header>
                            <p class="mb-0" th:text="#{invitation.form.header}">
                                Invite new members by email address
                            </p>
                        </header>

                        <div class="row">
                            <div class="col-12 col-md-8" th:with="control=${#forms.control('email')}">
                                <label th:for="${control.id}" th:text="#{invitation.form.labels.email}">
                                    Email address
                                </label>

                                <input
                                        required
                                        type="email"
                                        th:id="${control.id}"
                                        th:name="${control.name}"
                                        th:value="${control.value}"
                                        th:attr="aria-invalid=${control.aria.invalid}, aria-describedby=${control.aria.describedBy}"
                                >

                                <small th:id="${control.errors.id}"
                                       th:text="${control.errors.value}"
                                       th:unless="${#strings.isEmpty(control.errors.value)}"
                                       class="validation-error">
                                    Validation error text
                                </small>
                            </div>
                            <div class="col-12 col-md-4" th:with="control=${#forms.control('role')}">
                                <label th:for="${control.id}" th:text="#{invitation.form.labels.role}">
                                    Role
                                </label>

                                <select
                                        th:id="${control.id}"
                                        th:name="${control.name}"
                                        th:value="${control.value}"
                                        th:attr="aria-invalid=${control.aria.invalid}"
                                        aria-describedby="role-help"
                                >
                                    <option th:each="role : ${T(com.konfigyr.namespace.NamespaceRole).values()}"
                                            th:value="${role}"
                                            th:text="${#messages.msg('namespace.roles.' + role)}">
                                        Namespace Role
                                    </option>
                                </select>
                            </div>

                            <div class="col-12 validation-error" th:if="${#fields.hasGlobalErrors()}">
                                <svg th:replace="~{fragments/icon :: icon (name='alert-circle')}"></svg>
                                <th:block th:errors="*{global}">Errors</th:block>
                            </div>

                            <div class="col-12 text-center" th:if="${success}">
                                <div class="my-3 color-primary">
                                    <svg th:replace="~{fragments/icon :: icon (name='send', size='icon-4x')}"></svg>
                                </div>
                                <th:block class="mx-1" th:utext="${success}">Invite sent</th:block>
                            </div>
                        </div>

                        <footer class="d-flex align-items-center justify-content-between">
                            <small class="flex-grow-1" id="role-help" th:utext="#{invitation.form.help.role}">
                                <strong>User</strong> creates artifacts and uploads property metadata,
                                and an <strong>Admin</strong> has the full administration access of the team.
                            </small>
                            <button type="submit" class="mb-0" data-disable-invalid="true" th:text="#{invitation.form.labels.submit}">
                                Invite
                            </button>
                        </footer>
                    </article>
                </form>

                <form role="search" class="search-form mb-3" method="get">
                    <input name="q"
                           autocomplete="true"
                           autocapitalize="off"
                           spellcheck="false"
                           tabindex="0"
                           th:value="${term}"
                           class="m-0"
                           placeholder="Search members"
                           aria-label="Search members"
                    >
                    <button type="submit">
                        <svg th:replace="~{fragments/icon :: icon (name='search', size='icon-lg')}"></svg>
                    </button>
                </form>

                <article th:each="member : ${members}" class="d-flex flex-justify-between align-items-center flex-wrap">
                    <img th:replace="~{fragments/avatar :: avatar (
                        avatar=${member.avatar},
                        title=${member.displayName},
                        size='60px'
                        )}">

                    <div class="flex-grow-1 mx-3">
                        <p class="mb-0">
                            <strong class="d-block" th:text="${member.displayName}">John Doe</strong>
                            <small class="muted" th:text="${member.email}">john.doe@konfigyr.com</small>
                        </p>
                    </div>

                    <div class="mx-3">
                        <span class="badge" th:text="${#messages.msg('namespace.roles.' + member.role)}">
                            Admin
                        </span>
                    </div>

                    <div>
                        <details class="dropdown mb-0">
                            <summary role="button" aria-haspopup="listbox" class="secondary outline">
                                <th:block th:text="#{namespace.members.actions}">Actions</th:block>
                            </summary>
                            <ul role="listbox" style="--konfigyr-font-size: 0.9rem">
                                <li>
                                    <button th:attr="data-show-dialog='role-dialog-' + ${member.id.serialize()}"
                                            th:text="#{namespace.members.actions.update}">
                                        Change role
                                    </button>
                                </li>
                                <li>
                                    <button th:attr="data-show-dialog='remove-dialog-' + ${member.id.serialize()}"
                                            th:text="#{namespace.members.actions.remove}">
                                        Remove member
                                    </button>
                                </li>
                            </ul>
                        </details>
                    </div>
                </article>
            </div>

            <dialog th:each="member : ${members}"
                    th:with="element='role-dialog-' + ${member.id.serialize()}"
                    th:id="${element}"
                    class="modal" aria-modal="true">
                <form th:action="@{/namespace/{slug}/members/update(slug=${namespace.slug})}" method="post">
                    <input type="hidden" name="member" th:value="${member.id.serialize()}">

                    <article>
                        <header>
                            <h1 class="fs-6" th:text="${#messages.msg('namespace.members.roles.form.title', member.displayName)}">
                                Change the role of John Doe
                            </h1>
                        </header>
                        <fieldset name="namespace-type">
                            <legend class="required" th:text="#{namespace.members.roles.form.legend}">
                                Select a role for your team member
                            </legend>

                            <th:block th:replace="~{fragments/forms :: radio-box (
                                        name='role',
                                        option='ADMIN',
                                        value=${member.role},
                                        label=#{namespace.roles.ADMIN},
                                        help=#{namespace.roles.description.ADMIN}
                                    )}"/>
                            <th:block th:replace="~{fragments/forms :: radio-box (
                                        name='role',
                                        option='USER',
                                        value=${member.role},
                                        label=#{namespace.roles.USER},
                                        help=#{namespace.roles.description.USER}
                                    )}"/>
                        </fieldset>
                        <footer>
                            <button class="secondary" type="reset"
                                    th:attr="data-close-dialog=${element}"
                                    th:text="#{dialog.close}">
                                Close
                            </button>
                            <button type="submit" th:text="#{namespace.members.roles.form.submit}">
                                Submit
                            </button>
                        </footer>
                    </article>
                </form>
            </dialog>

            <dialog th:each="member : ${members}"
                    th:with="element='remove-dialog-' + ${member.id.serialize()}"
                    th:id="${element}"
                    class="modal" aria-modal="true">>
                <article>
                    <header>
                        <h1 class="fs-6" th:text="#{namespace.members.remove.title}">
                            Removing member from team
                        </h1>
                    </header>
                    <div th:utext="${#messages.msg('namespace.members.remove.confirm', member.displayName)}">
                        Are you sure you wish to remove <strong>John Doe</strong> from this namespace?
                    </div>
                    <footer>
                        <form th:action="@{/namespace/{slug}/members/remove(slug=${namespace.slug})}" method="post">
                            <input type="hidden" name="member" th:value="${member.id.serialize()}">

                            <button type="reset" class="secondary"
                                    th:attr="data-close-dialog=${element}"
                                    th:text="#{dialog.close}">
                                Close
                            </button>

                            <button type="submit" class="outline danger" th:text="#{namespace.members.remove.submit}">
                                Remove member
                            </button>
                        </form>
                    </footer>
                </article>
            </dialog>
        </div>
    </div>
</main>
</body>
</html>