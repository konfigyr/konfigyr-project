apply plugin: 'org.springframework.boot'

tasks.named('bootBuildImage') {
    def tag = Boolean.valueOf(System.getenv('NIGHTLY')) ? 'latest' : project.version

    imageName = "konfigyr/${project.name}:${tag}"

    environment['BPE_APPEND_JAVA_TOOL_OPTIONS'] = '-XX:MaxDirectMemorySize=10M, -XX:MaxMetaspaceSize=74150K, -XX:ReservedCodeCacheSize=120M'

    docker {
        publishRegistry {
            username = 'konfigyr'
            password = System.getenv('DOCKER_HUB_TOKEN')
        }
    }
}
